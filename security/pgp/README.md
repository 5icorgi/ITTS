## [原创] 从一个简单的备份需求说起

本文原创：**中国科学技术大学 张焕杰**

修改时间：2019.01.26

## 一、一个简单需求

领导说：要保障数据安全，做好备份工作。现在预算紧张，有那么多免费的云空间，能否直接备份到云上呢？

## 二、需求逐步落实

各种脚本可以上传/下载云空间文件，只要解决了安全问题，使用云空间备份是可行的。

为了安全，显然要在备份上传前对文件进行加密。说到加密，就离不开两种加解密算法：

### 2.1 对称加解密算法

对称加解密算法，它的特点是加密和解密操作使用同样的密钥key。
常见的对称加解密算法有AES、3DES等，一般来说性能很高，每秒钟可以加解密100MB字节或更多的信息。

一旦密钥key泄漏，加密的信息就可以被解密，也就是泄漏了。

如果使用对称加密算法加密备份文件，然后再上传到云空间，似乎能解决数据安全问题，但实际上这样做有很大的安全隐患：

对称加解密算法加密时需要密钥key，为了自动化操作，势必要在服务器上存放密钥key。一旦服务器被入侵，密钥key泄漏，之前所有加密的备份文件，都可以被解密而泄漏。

### 2.2 非对称加解密算法

非对称加解密算法，它的特点是加密和解密操作使用不同的密钥。2个密钥成对出现，1个称为私钥(private key)需要私密保存，另1个称为公钥(public key)可以对外公开。
在单独知道公钥的情况下，短时间无法推导或计算出私钥。

常见的非对称加解密算法是RSA、ECC，一般来说加密/解密的性能比对称加解密算法要慢2-3个数量级。

除了简单加解密外，非对称加解密算法还可以完成数字签名、身份认证等工作。
如果说对称加解密是农耕时代，非对称加解密算法则是进入到电气化时代。

对于上述备份加密需求，服务器上可以仅仅存放公钥，备份文件使用公钥加密后上传到云空间。公钥本来就是公开的，即使服务器被入侵，也不会泄漏什么。
需要解密文件时，再拿出单独保存的私钥来完成文件解密操作。

### 2.3 实际应用

实际使用时，往往采用非对称加解密算法来加密解密文件的密钥key，然后使用性能高的对称加解密算法使用文件密钥key完成对文件的快读加解密操作。这样做既保证了安全性，又能提供很高的性能。

以上原理看起来复杂，实际操作时很容易，使用常见的gpg(GnuPGP)软件，主要包含如下步骤：
* 生成私钥和公钥
* 把公钥导入要备份的服务器
* 加密文件
* 导入私钥
* 解密文件

以下演示在CentOS 7.0下完成，gpg版本是 2.0.22

* [How To Set Up Multi-Factor Authentication for SSH on Ubuntu 16.04](https://www.digitalocean.com/community/tutorials/how-to-set-up-multi-factor-authentication-for-ssh-on-ubuntu-16-04)


***
欢迎 [加入我们整理资料](https://github.com/bg6cq/ITTS)
